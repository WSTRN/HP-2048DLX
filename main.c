
#include "ggl.h"
#include "ggl_extlib.h"
#include "keyb.h"
#include "sys.h"
#include <hpgcc3.h>
#include <stdint.h>
#include <time.h>
#include "port.h"
#include "fsystem.h"

const uint8_t fill1[] = {
	0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0,0xe0
};
const uint8_t fill2[] = {
	0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0x0e,0xe0
};
#define F1 "PREV"
#define F2 "NEXT"
#define F3 "ANMI"
#define F4 "SAVE"
#define F5 "EXIT"
#define F6 "OK"

gglsurface s;
gglsurface rs;
// uint8_t surfacebuff[128 * 32 / 2];
int vbuff;
void app_2048_main();
void draw_background();
int main()
{
    ggl_initscr(&rs);
    lcd_setmode(MODE_16GRAY, rs.addr);
    vbuff=(int)sys_phys_malloc( 128*32 + 16);
    s.addr = (int *)((sys_map_v2p(vbuff)+15)&0xfffffff0);
    s.width = 128;
    s.x=0;
    s.y=0;

    
    ML_port();
    draw_background();
    app_2048_main();


    // int a,b;
    // FS_FILE* rf;
    // FS_FILE* wf;
    // int e;
    // e = FSOpen("2048DL.sav", FSMODE_READ, &rf);
    // printf("%d\n",e); 
    // if(e==FS_OK)
    // {
    //     e = FSRead((char*)&b, 4, rf);
    //     printf("%d\n",e);
    //     printf("%d\n",b);
    //     e = FSClose(rf);
    //     printf("%d\n",e);
    // }
    

    // e = FSOpen("2048DL.sav", FSMODE_MODIFY, &rf);
    // printf("%d\n",e);
    // scanf("%d", &a);
    // e = FSWrite((char*)&a, 4, rf);
    // printf("%d\n",e);
    // e= FSClose(rf);
    // printf("%d\n",e);



    


    
    // while(!keyb_isKeyPressed(KB_ON));
    return 0;
}

void draw_background()
{
    ggl_rect(&rs, 0, 0, 130, 79, ggl_mkcolor(0));
    ggle_bmp(&rs, 0, 0, fill1, 131, 1);
    ggle_bmp(&rs, 0, 1, fill2, 131, 1);
    ggle_bmp(&rs, 0, 2, fill1, 131, 1);
    ggle_bmp(&rs, 0, 3, fill2, 131, 1);
    ggle_bmp(&rs, 0, 4, fill1, 131, 1);
    ggle_bmp(&rs, 0, 5, fill2, 131, 1);
    ggle_bmp(&rs, 0, 6, fill1, 131, 1);
    ggle_bmp(&rs, 0, 7, fill2, 131, 1);
    ggl_rect(&rs, 0, 73, 20, 79, ggl_mkcolor(15));
    ggl_rect(&rs, 22, 73, 42, 79, ggl_mkcolor(15));
    ggl_rect(&rs, 44, 73, 64, 79, ggl_mkcolor(15));
    ggl_rect(&rs, 66, 73, 86, 79, ggl_mkcolor(15));
    ggl_rect(&rs, 88, 73, 108, 79, ggl_mkcolor(15));
    ggl_rect(&rs, 110, 73, 130, 79, ggl_mkcolor(15));
    ggle_Text(&rs, F1, 1, 74, TXT_MINISD);
    ggle_Text(&rs, F2, 23, 74, TXT_MINISD);
    ggle_Text(&rs, F3, 45, 74, TXT_MINISD);
    ggle_Text(&rs, F4, 67, 74, TXT_MINISD);
    ggle_Text(&rs, F5, 89, 74, TXT_MINISD);
    ggle_Text(&rs, F6, 111, 74, TXT_MINISD);

    // ML_rectangle(64,0,127,63,2,1,0);
    // // // ML_rectangle(20,20,107,43,0,0,2);
    // // ML_bmp_or(P2[2],60,10,16,16);
    // // ML_bmp_or(TexteMenu[3],50,40,59,7);
    // Txt_Point(1,1,1,TXT_OR);
    // Txt_Point(124,3,1,TXT_OR);
    // Txt_Point(126,62,1,TXT_XOR);
    // // Txt_Point(127,0,1,TXT_XOR);
    // ML_display_vram();

}